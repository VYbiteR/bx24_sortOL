<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ANIT B24 Chat Sorter — Настройки</title>
  <style>
    :root{
      --bg:#0f1115;
      --panel:#1f232b;
      --panel2:#12151b;
      --text:#e9edf1;
      --muted:rgba(255,255,255,.65);
      --brd:rgba(255,255,255,.15);
      --brd2:rgba(255,255,255,.10);
      --btn:#1f232b;
      --btn2:#2a303b;
      --danger:#b04b4b;
      --ok:#3aa56a;
      --warn:#b48a3b;
    }
    html,body{height:100%}
    body{
      margin:0;
      font:13px/1.35 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg);
      color:var(--text);
    }
    .wrap{
      max-width:980px;
      margin:0 auto;
      padding:18px 16px 28px;
    }
    h1{font-size:16px;margin:0 0 10px}
    .sub{color:var(--muted);margin:0 0 14px}
    .card{
      background:var(--panel);
      border:1px solid var(--brd);
      border-radius:12px;
      padding:12px;
      box-shadow:0 8px 24px rgba(0,0,0,.25);
    }
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .row + .row{margin-top:10px}
    .grow{flex:1 1 auto}
    input[type="text"]{
      width:100%;
      background:var(--panel2);
      color:var(--text);
      border:1px solid var(--brd2);
      border-radius:10px;
      padding:8px 10px;
      outline:none;
    }
    input[type="text"]:focus{border-color:rgba(255,255,255,.22)}
    button{
      background:var(--btn);
      color:var(--text);
      border:1px solid var(--brd);
      border-radius:10px;
      padding:7px 10px;
      cursor:pointer;
      user-select:none;
    }
    button:hover{background:var(--btn2)}
    button.danger{border-color:rgba(176,75,75,.6); color:#ffdede}
    .hint{color:var(--muted);font-size:12px}
    .tbl{
      width:100%;
      border-collapse:separate;
      border-spacing:0;
      overflow:hidden;
      border-radius:12px;
      border:1px solid var(--brd);
      background:rgba(0,0,0,.08);
    }
    .tbl th,.tbl td{
      padding:8px 10px;
      border-bottom:1px solid rgba(255,255,255,.08);
      vertical-align:middle;
    }
    .tbl th{
      text-align:left;
      font-size:12px;
      color:var(--muted);
      background:rgba(0,0,0,.12);
    }
    .tbl tr:last-child td{border-bottom:none}
    .chk{display:flex;align-items:center;gap:6px}
    .badge{
      font-size:11px;
      padding:2px 7px;
      border-radius:999px;
      border:1px solid var(--brd);
      color:var(--muted);
      background:rgba(0,0,0,.12);
    }
    .status{min-height:18px}
    .status.ok{color:#bff0d2}
    .status.err{color:#ffd0d0}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>ANIT B24 Chat Sorter — Настройки маппинга</h1>
    <p class="sub">
      Для каждого портала можно указать сервер, который отдаёт <span class="badge">/mapping.php</span>.
      Если портал не настроен — расширение работает как раньше (без проектов).
    </p>

    <div class="card">
      <div class="row">
        <div class="grow">
          <div class="hint">Портал (host)</div>
          <input id="portalHost" type="text" placeholder="например: anit.bitrix24.ru" />
        </div>
        <div class="grow">
          <div class="hint">Сервер маппинга (base URL)</div>
          <input id="serverBase" type="text" placeholder="например: https://map.anit.ru" />
        </div>
        <div class="chk" style="min-width:120px">
          <input id="enabled" type="checkbox" checked />
          <label for="enabled">включено</label>
        </div>
        <button id="addBtn">Добавить / обновить</button>
      </div>

      <div class="row" style="justify-content:space-between">
        <div class="hint">
          Сервер будет запрашиваться раз в 2 часа с заголовком <span class="badge">X-ANIT-AGENT: anitBXChatSorter</span> и ETag.
        </div>
        <button id="clearBtn" class="danger">Очистить все</button>
      </div>

      <div class="row">
        <div id="status" class="status"></div>
      </div>

      <div class="row" style="margin-top:10px">
        <table class="tbl">
          <thead>
            <tr>
              <th style="width:260px">Портал</th>
              <th>Сервер</th>
              <th style="width:110px">Статус</th>
              <th style="width:130px"></th>
            </tr>
          </thead>
          <tbody id="rows"></tbody>
        </table>
      </div>
    </div>
  </div>

  <script src="options.js"></script>
</body>
</html>
